unit uSearch;

interface

uses
  uISearch,
  uEventManager,
  Classes;

type
  TSearch = class(TInterfacedObject, ISearch)
  private
    type
      TEventManager = class
        BeforeSearch: TEvents;
        AfterSearch: TEvents;
        BeforeFillResult: TEvents;
        AfterFillResult: TEvents;
        BeforeShow: TEvents;
        AfterShow: TEvents;
        BeforeClose: TEvents;
        AfterClose: TEvents;
      end;
  private
    procedure DoEvent(Event: TNotifyEvent);
  protected
    Events: TEventManager;
    OnSearch: TNotifyEvent;
    OnFillResult: TNotifyEvent;
    OnShow: TNotifyEvent;
    OnClose: TNotifyEvent;
  protected
     /// <summary>
    ///   Выполненить поиск (источник - определяется вами)
    /// </summary>
    procedure Search; virtual;
    /// <summary>
    ///   Заполнить объект представления резльтатами поиска
    /// </summary>
    procedure FillResult; virtual;
    /// <summary>
    ///   Открыть окно поиска
    /// </summary>
    procedure Show; virtual;
    /// <summary>
    ///   Закрыть окно поиска
    /// </summary>
    procedure Close; virtual;
  public
    constructor Create; virtual;
    destructor Destroy; override;
  end;

implementation

{ TSearch }

procedure TSearch.Close;
begin
  Events.BeforeClose.DoEvents;
  DoEvent(OnClose);
  Events.AfterClose.DoEvents;
end;

constructor TSearch.Create;
begin
Events := TEventManager.Create
end;

destructor TSearch.Destroy;
begin

  inherited;
end;

procedure TSearch.DoEvent(Event: TNotifyEvent);
begin
  if Assigned(Event) then
    Event(Self)
end;

procedure TSearch.FillResult;
begin
  Events.BeforeFillResult.DoEvents;
  DoEvent(OnFillResult);
  Events.AfterFillResult.DoEvents;
end;

procedure TSearch.Search;
begin
  Events.BeforeSearch.DoEvents;
  DoEvent(OnSearch);
  Events.AfterSearch.DoEvents;
end;

procedure TSearch.Show;
begin
  Events.BeforeShow.DoEvents;
  DoEvent(OnShow);
  Events.AfterShow.DoEvents;
end;

end.


